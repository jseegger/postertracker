<!DOCTYPE html>
<html lang="de">
<head><meta charset="UTF-8"><title>Pin-Farben Einstellungen</title></head>
<body>
  <h3>Liste → Pin-Farbe</h3>
  <div id="mapping-container"></div>
  <button id="save">Speichern</button>
  <script src="https://jseegger.github.io/postertracker/js/settings.js"></script>
</body>
</html>

// ---------- settings.js ----------
var t = window.TrelloPowerUp.iframe();
// Lädt bestehendes Mapping
t.get('board', 'shared', 'pinColorMapping').then(function(mapping){
  mapping = mapping || {};
  return t.board('lists').then(function(board){
    var container = document.getElementById('mapping-container');
    board.lists.forEach(function(list){
      var row = document.createElement('div');
      row.innerHTML = list.name + ': <input type="color" data-list-id="' + list.id + '" value="' + (mapping[list.id]|| '#3388ff') + '" />';
      container.appendChild(row);
    });
  });
}).then(function(){
  document.getElementById('save').addEventListener('click', function(){
    var inputs = document.querySelectorAll('input[data-list-id]');
    var newMap = {};
    inputs.forEach(function(inp){ newMap[inp.dataset.listId] = inp.value; });
    t.set('board', 'shared', 'pinColorMapping', newMap).then(function(){
      t.closePopup();
    });
  });
});
